<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>记录今天遇到的两个坑 | 金天的个人博客</title>
    <meta property="og:title" content="记录今天遇到的两个坑 - 金天的个人博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2019-06-25T18:07:41&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2019-06-25T18:07:41&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,金天,人工智能,java,android,博客,项目管理,python,软件架构,公众号,小程序,AI项目管理">
    <meta name="description" content="记录今天遇到的两个坑">
        
    <meta name="author" content="金天">
    <meta property="og:url" content="https://jintian93.github.io/post/2019_06_25_18_%E8%AE%B0%E5%BD%95%E4%BB%8A%E5%A4%A9%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%9D%91/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "238864368",
        enable_page_level_ads: true
    });
    </script>
    


    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://jintian93.github.io">
                        金天的个人博客
                    </a>
                
                <p class="description">专注于AI算法研发与落地应用，无人驾驶，模型压缩与加速，边缘端侧推理，AI项目管理与核心技术输出，腾讯自动驾驶专家</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://jintian93.github.io">首页</a>
                    
                    <a  href="https://jintian93.github.io/tools/" title="工具">工具</a>
                    
                    <a  href="https://jintian93.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://jintian93.github.io/about/" title="关于">关于</a>
                    
                    <a  href="https://jintian93.github.io/about/" title="关于我">关于我</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents"></nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">记录今天遇到的两个坑</h1>
        </header>
        <date class="post-meta meta-date">
            2019年6月25日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>本文介绍 记录今天遇到的两个坑</p>
<!-- raw HTML omitted -->
<h1 id="heading">记录今天遇到的两个坑</h1>
<blockquote>
<p>This article was original written by Jin Tian, welcome re-post, first come with <a href="https://jinfagang.github.io">https://jinfagang.github.io</a> . but please keep this copyright info, thanks, any question could be asked via wechat: <code>jintianiloveu</code></p>
</blockquote>
<p>今天遭遇了两个坑，都是关于C++的。总结来说就几点：</p>
<ul>
<li>以后部署环境尽量，千万别，也没必要，不用，不需要自己从源码安装某个库。因为你无法保证别人编译安装的链接版本号就是一致的。相反，从apt统一安装是最好的方式；</li>
<li>boost从apt安装是没问题的，你caffe编译应该是没问题的；</li>
<li>linux这种的源码依赖方式说实话有时候问题很大，有时间得好好了解一下下一代操作系统以及操作系统编程语言，也就rust和fuchsia；</li>
</ul>
<p>还有一个坑来自于ROS。</p>
<p>这个坑更大，源自于ros和libtorch的集成。事情是这样的。</p>
<p>我本想集成一个基于libtorch的程序进入ros，但是二者冲突，当我链接libtorch的时候，ros无法正确连接到对应的&hellip;. 库。当我把libtoch的链接库comment掉，一切正常。</p>
<p>可能的原因是我ros相关依赖真的没有，因为我卸载过一次boost，而这个卸载会把ros相关库一并卸载掉。那我tm就纳闷了，都TM卸载了，你怎么还能编译？？？？</p>
<p>另外我在这种情况下，尽然可以编译出可执行程序，可我发现我tm连rosrun都没有，catkinmake你怎么做到的？？？</p>
<pre><code>
catkin_package(
        #  INCLUDE_DIRS include
        #  LIBRARIES semantic_seg
        #  CATKIN_DEPENDS other_catkin_pkg
        #  DEPENDS system_lib
)
</code></pre><p>这行代码没有什么用，但是在ros里面，如果 你不加它，那rosrun就无法找到执行脚本！！！！ <strong>无法找到！！太他妈的神奇的ros了</strong></p>
<p>最后我发现一个很严重的问题：</p>
<ul>
<li>C++各种依赖很头疼，但是习惯也还好；</li>
<li>但是到了ROS，tm的起码复杂了1000倍！我认为替代C++应该先把ros这一套先干掉，太复杂了。</li>
</ul>
<p>最后还有一个奇葩问题，我tm的窗口怎么只有关闭按钮了？？？</p>
<p><img src="./assets/1561533004814.png" alt="1561533004814"></p>
<p>真的是。。。。。。</p>
<p><strong>最终发现可能原因</strong></p>
<p><a href="https://discuss.pytorch.org/t/issues-linking-with-libtorch-c-11-abi/29510/2">https://discuss.pytorch.org/t/issues-linking-with-libtorch-c-11-abi/29510/2</a></p>
<p>来自pytorch论坛的论述：</p>
<pre><code>So, it seems that I’ve found the issue. The TorchConfig.cmake has this piece of config:

if (&quot;${CMAKE_CXX_COMPILER_ID}&quot; STREQUAL &quot;GNU&quot;)
  set(TORCH_CXX_FLAGS &quot;-D_GLIBCXX_USE_CXX11_ABI=0&quot;)
endif()
Which forces GCC to use the old C++11 ABI. Is there any reason why libtorch is being built using the old ABI ? Because what happens is that every single dependency that I have on my project such as leveldb or grpc for instance, won’t be able to be linked because they were compiled with the newer C++11 ABI. And I guess that this is the most common situation for other projects.

If I manually change GLIBCXX_USE_CXX11_ABI=1 and recompile the entire libtorch by myself, it works just fine, but that requires a lot of manual steps that aren’t quite easy to integrate into my CMake file. Not to mention that it’s really hard to figure out how to compile the libtorch correctly.

Are there any plans to move to the newer C++11 ABI and thus allow other dependencies to be linked without problems ? Otherwise, people will have a lot of trouble to depend on the libtorch libraries.
</code></pre><p>这句话什么意思呢？也就说libtorch默认使用了比较老的版本的ABI，而我们的ros或者其他很多程序都用的新的ABI。他妈的这就导致了这个玩意跟其他任何库都可能无法一起编译！！</p>
<p>这个人解释了为什么pytorch要用老的ABI编译：</p>
<p><img src="./assets/1561534490010.png" alt="1561534490010"></p>
<p>这个是啥意思呢？他们用的是gcc4.9，而这个只能使用老的ABI，他们的理由就是低版本的高版本也能用，但是高版本的低版本是用不了的。</p>
<p>沃日，真tm的坑。这群facebook的程序员。</p>
<p><strong>坑在继续</strong>.</p>
<p>感觉tm的ros跟libtorch是冤家对头啊！！</p>
<p>你libtorch用低版本的编译的对吧？那么我在cmake里面去掉高版本的ABI可以吧？兼容你的低版本：</p>
<pre><code>add_compile_options(-std=c++11 -D_GLIBCXX_USE_CXX11_ABI=0)
</code></pre><p>可是问题是！！！！这个加入之后，他妈的，ros就无法执行了。ros不支持降低ABI。。。。。。。</p>
<p>我也是无语了。</p>
<p>最后是从源码编译pytorch。不过请注意，从源码编译的时候千万不要直接从master分支，会踩坑。</p>
<p>切换到v1.1.0分支，可以从源码编译，完了之后把我们需要的链接库替换掉即可。</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://jintian93.github.io">金天</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://jintian93.github.io/post/2019_06_25_18_%E8%AE%B0%E5%BD%95%E4%BB%8A%E5%A4%A9%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%9D%91/">https://jintian93.github.io/post/2019_06_25_18_%E8%AE%B0%E5%BD%95%E4%BB%8A%E5%A4%A9%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%9D%91/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/2019_06_20_11_ROIPooling%E4%B8%8EROIAlign%E7%9A%84%E6%80%9D%E8%80%83/">ROIPooling与ROIAlign的思考</a></li>
        
        <li><a href="/post/2019_05_22_17_%E5%8D%B7%E7%A7%AF%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96%E4%B8%8Ewinogra%E7%AE%97%E6%B3%95/">卷积算法优化与winogra算法</a></li>
        
        <li><a href="/post/2019_05_22_09_pytorch%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AACrossEntropy%E5%87%BD%E6%95%B0/">pytorch自己实现一个CrossEntropy函数</a></li>
        
        <li><a href="/post/2019_05_14_11_%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%86%8D%E5%86%8D%E6%80%9D%E8%80%83/">卡尔曼滤波跟踪再再思考</a></li>
        
        <li><a href="/post/2019_03_31_11_%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9A%E4%BD%8D%E6%8A%80%E6%9C%AF%E7%AA%A5%E6%8E%A2/">计算机视觉定位技术窥探</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "jintian93/coment-for-blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://jintian93.github.io/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://jintian93.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://jintian93.github.io/post/2020_12_02_15_%E6%88%91%E7%9A%842021%E7%9A%84FLAG%E8%AF%95%E8%A1%8C%E7%89%88/" title="2020FLAG试行版">2020FLAG试行版</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_11_28_20_%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%95%99%E4%BD%A0%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E4%B8%80%E4%B8%AA%E4%B8%AD%E6%96%87%E8%AF%AD%E9%9F%B3tts/" title="一篇文章教你语音合成入门，训练一个中文语音tts">一篇文章教你语音合成入门，训练一个中文语音tts</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_12_02_17_%E8%AE%B0%E5%BD%95%E4%B8%80%E4%BA%9B%E6%9C%80%E8%BF%91%E7%9A%84%E8%A7%84%E5%88%92%E5%92%8C%E6%89%93%E7%AE%97/" title="记录一些最近的规划和打算">记录一些最近的规划和打算</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_11_07_22_JetsonNano2GB%E7%BC%96%E8%AF%91Yolov5%E5%B9%B6%E7%94%A8TensorRT%E5%8A%A0%E9%80%9F%E6%95%99%E7%A8%8B/" title="JetsonNano2GB编译Yolov5并用TensorRT加速教程">JetsonNano2GB编译Yolov5并用TensorRT加速教程</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_10_26_22_Jetson_Nano_2GB%E5%85%A8%E6%96%B0%E6%B5%8B%E8%AF%84/" title="Jetson Nano 2GB全新测评">Jetson Nano 2GB全新测评</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_09_27_12_UltraFastYoloV5%E5%8F%91%E5%B8%83%E5%9F%BA%E4%BA%8E%E5%89%AA%E6%9E%9D%E6%8A%80%E6%9C%AF%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A93ms%E6%8E%A8%E7%90%86%E7%9A%84YoloV5mAP60&#43;/" title="UltraFastYoloV5发布!基于剪枝技术的模型压缩,3ms推理的YoloV5mAP60&#43;!">UltraFastYoloV5发布!基于剪枝技术的模型压缩,3ms推理的YoloV5mAP60&#43;!</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_09_14_11_%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAYoloV5%E6%A8%A1%E5%9E%8B%E5%B9%B6%E8%AE%AD%E7%BB%83%E6%95%99%E7%A8%8B/" title="从零开始搭建YoloV5模型并训练教程">从零开始搭建YoloV5模型并训练教程</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_08_31_12_%E8%B6%85%E5%BF%AB%E7%9A%84%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8BTensorRT%E9%83%A8%E7%BD%B2120fps/" title="超快的车道线检测TensorRT部署:120fps">超快的车道线检测TensorRT部署:120fps</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_08_14_17_Pytorch%E7%BD%91%E7%BB%9C%E5%8E%8B%E7%BC%A9%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%E4%B8%80Prune%E4%BD%A0%E7%9A%84%E6%A8%A1%E5%9E%8B/" title="Pytorch网络压缩系列教程一:Prune你的模型">Pytorch网络压缩系列教程一:Prune你的模型</a>
    </li>
    
    <li>
        <a href="https://jintian93.github.io/post/2020_07_31_14_%E5%85%A8%E7%BD%91%E6%9C%80%E5%85%A8%E7%9B%98%E7%82%B9%E9%82%A3%E4%BA%9B%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%B9%BF%E6%96%B9%E5%BC%8FMosiacMixUpCutMix%E7%AD%89./" title="全网最全:盘点那些图像数据增广方式Mosiac,MixUp,CutMix等.">全网最全:盘点那些图像数据增广方式Mosiac,MixUp,CutMix等.</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="http://manaai.cn" title="【2020】中秋特惠，神力平台终身会员优惠85折！立即开通" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1_rYHo7P2gK0jSZPxXXacQpXa-690-388.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="http://manaai.cn" title="助力产业智慧升级，云服务器首年88元起，更有千元代金券礼包免费领！" target="_blank" style="color:red">
                
                    <img src="https://upload-dianshi-1255598498.file.myqcloud.com/345-7c71532bd4935fbdd9a67c1a71e577b1767b805c.200%E7%89%88%E6%9C%ACB.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="http://manaai.cn" title="【渠道专享低折扣】11月特惠 限时2折" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1hblJl7Y2gK0jSZFgXXc5OFXa-750-400.jpg">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="http://manaai.cn" title="神力AI平台">神力AI平台</a>
        </li>
        
        <li>
            <a target="_blank" href="http://zhuanlan.zhihu.com/ai-man" title="【知乎专栏】人工智能从入门到逆天杀神">Android Gradle权威指南</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://jintian93.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="https://jintian93.github.io">金天的个人博客 By 金天</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>

</body>

</html>